var informazioni_prenotazione;window.onload=function(){document.getElementById("set-prenotation").style.display="block",document.getElementById("end-prenotation").style.display="none",document.getElementById("show-pren-details").style.display="none",document.getElementById("logged-in-confirmation").style.display="none",document.getElementById("modal").style.display="block",document.getElementById("time-elapsed").style.display="none",document.getElementById("popup-overlay").style.display="none",document.getElementById("popup").setAttribute("aria-hidden","true"),document.getElementById("popup").setAttribute("tabindex","-1"),window.addEventListener("scroll",function(){window.scrollY>100?document.querySelector("header").classList.add("is-scrolling"):document.querySelector("header").classList.remove("is-scrolling")});let e=document.querySelector(".hamburger"),t=document.querySelector(".mobile-nav");e.addEventListener("click",function(){e.classList.toggle("is-active"),t.classList.toggle("is-active")});let n=window.location.pathname.replace(/\/[^\/]+$/,""),o="";o=n.includes("/php")?window.location.origin+n+"/auth.php":window.location.origin+n+"/php/auth.php";let l=document.getElementById("login-link-desk"),i=document.getElementById("login-link-mob");null!==l&&null!==i&&fetch(o).then(e=>e.text()).then(e=>{let t=JSON.parse(e);l.textContent=t.logged_in?"Area riservata":"Accedi",i.textContent=t.logged_in?"Area riservata":"Accedi"})},window.addEventListener("DOMContentLoaded",checkWindowSize),window.addEventListener("resize",checkWindowSize),document.addEventListener("DOMContentLoaded",function(){document.getElementById("data-description").classList.add("appear")});const display=document.getElementById("countdown"),circle=document.getElementById("circle");let countdownInterval;function scrollToTop(){window.scrollTo({top:0,behavior:"smooth"})}function stopCountdown(){document.getElementById("countdown").textContent="10:00",clearInterval(countdownInterval)}function validateFormLogin(e){e.preventDefault();var t=document.getElementById("email").value.trim(),n=document.getElementById("password").value.trim(),o=document.getElementById("errore_email"),l=document.getElementById("errore_password");if(""===t)return o.textContent="Il campo email \xe8 vuoto.",o.style.display="block",!1;if(o.textContent="",""===n)return l.textContent="Il campo password \xe8 vuoto.",l.style.display="block",!1;l.textContent="";let i=new URLSearchParams;for(let a of(i.append("email",t),i.append("password",n),informazioni_prenotazione.entries()))i.append(a[0],a[1]);fetch("../php/verificaCredenziali.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i}).then(e=>e.text()).then(e=>{if(esito=JSON.parse(e),document.getElementById("messaggioLogin").textContent="",esito.loginResult){stopCountdown(),document.getElementById("messaggioLogin").textContent="",document.getElementById("overlay").style.display="none",document.getElementById("set-prenotation").style.display="none",document.getElementById("end-prenotation").style.display="none",document.getElementById("show-pren-details").style.display="block",document.getElementById("logged-in-confirmation").style.display="block";let t=document.getElementById("back-to-times");return t.addEventListener("click",function(){fetch("../php/rilascioPrenotazione.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:informazioni_prenotazione.toString()}),document.getElementById("set-prenotation").style.display="block",document.getElementById("show-pren-details").style.display="none",document.getElementById("logged-in-confirmation").style.display="none",scrollToTop()}),!0}return"registeredResult"in esito&&(esito.registeredResult?document.getElementById("messaggioLogin").textContent="La password inserita non \xe8 corretta.":document.getElementById("messaggioLogin").textContent="Utente non registrato."),!1}).catch(e=>console.error("Errore:",e))}function checkWindowSize(){let e=window.innerWidth,t=document.querySelector(".mobile-nav"),n=document.getElementById("menu"),o=document.querySelector(".bar");e<=1032?(t.setAttribute("aria-hidden","false"),t.setAttribute("tabindex","0"),o.setAttribute("aria-hidden",!1),o.setAttribute("tabindex","-1"),n.setAttribute("aria-hidden","true"),n.setAttribute("tabindex","-1")):(t.setAttribute("aria-hidden","true"),t.setAttribute("tabindex","-1"),o.setAttribute("aria-hidden",!0),o.setAttribute("tabindex","0"),n.setAttribute("aria-hidden","false"),n.setAttribute("tabindex","0"))}document.addEventListener("DOMContentLoaded",function(){function e(){var e=document.getElementById("dataSelezionata"),t=new Date().toISOString().split("T")[0];e.value=t,fetch("../php/dateSelect.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"selectedDate="+new Date(e.value).toISOString().split("T")[0]}).then(e=>e.text()).then(e=>{a(e)}).catch(e=>console.error("Errore:",e))}e();var t=document.getElementById("fieldContainerSection"),n=document.getElementById("confirmationButtonContainer");n.style.display="none";var o=[];let l=0;var i=new URLSearchParams(window.location.search).get("option");function a(e){t.innerHTML="";var a=document.createElement("div");a.className="field-container sport",a.id=i,Modernizr.addTest("webp",function(){return 0===document.createElement("canvas").toDataURL("image/webp").indexOf("data:image/webp")});var r=Modernizr.webp?"webp-supported":"no-webp";a.classList.add(r);var d=document.createElement("h2");d.textContent=i.charAt(0).toUpperCase()+i.slice(1);var s=document.createElement("div");s.className="time-buttons";var p=["08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00"].filter(t=>!e.includes(t));if(0==p.length){var c=document.createElement("p");c.textContent="La disponibilit\xe0 dei campi \xe8 esaurita. Si prega di selezionare un'altra data.",a.appendChild(d),a.appendChild(c)}else{var y=!1;p.forEach(function(e){var t=document.createElement("input");t.type="button",t.value=e,t.addEventListener("click",function(){var e,i;(l<2||t.classList.contains("selected"))&&(t.classList.toggle("selected"),(e=t).classList.contains("selected")?o.push(e):o=o.filter(t=>t!==e),o.length>0?n.style.display="block":n.style.display="none",y||(i=document.getElementById("continueButton").getBoundingClientRect().top+window.scrollY,window.scrollTo({top:i,behavior:"smooth"}),y=!0),l=document.querySelectorAll(".selected").length)}),s.appendChild(t)}),a.appendChild(d),a.appendChild(s)}t.appendChild(a)}var r=document.getElementById("dataSelezionata");function d(e){(o=document.getElementById("dataSelezionata"))&&o.blur();var t=document.activeElement,n=document.getElementById("popup-overlay");n.style.display="block";var o,l=document.getElementById("popup");l.setAttribute("aria-hidden","false"),l.setAttribute("tabindex","0"),l.focus(),document.getElementById("popup-msg").textContent=e,document.getElementById("confirm-btn").addEventListener("click",function(){n.style.display="none",l.setAttribute("aria-hidden","true"),l.setAttribute("tabindex","-1"),t.focus()})}r.addEventListener("change",function(){var t=new Date(r.value),n=new Date;n.setHours(0,0,0,0);var o=new Date;(o.setMonth(n.getMonth()+1),t<n)?(d("Si prega di non selezionare una data passata"),e()):t>o?(d("Si prega a selezionare una data compresa tra la data corrente ed un mese dalla data corrente"),e()):fetch("../php/dateSelect.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"selectedDate="+new Date(r.value).toISOString().split("T")[0]}).then(e=>e.text()).then(e=>{a(e)}).catch(e=>console.error("Errore:",e))});let s=document.getElementById("continueButton");var p=[];s.addEventListener("click",function(){var e=document.getElementById("dataSelezionata").value;let t=new URLSearchParams;t.append("selectedDate",e),t.append("selectedButton1",o[0]?o[0].value:null),t.append("selectedButton2",o[1]?o[1].value:null),fetch("../php/bloccaPrenotazione.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t.toString()}).then(e=>e.text()).then(t=>{var n=(p=JSON.parse(t))[0]?p[0].ora_1:null,o=p[1]?p[1].ora_2:null,l=p[0]?p[0].campo1:null,a=p[1]?p[1].campo2:null;(function e(t,n,o,l,i,a){document.getElementById("chosen_activity").textContent=t,document.getElementById("chosen_date").textContent=n;var r=document.getElementById("div-time1");if(r){if(null!=o&&null!=i){r.style.display="block";var d=document.createElement("p");d.textContent="Ora: "+o+" - Codice campo: "+i,r.appendChild(d)}else r.style.display="none"}var s=document.getElementById("div-time2");if(s){if(null!=l&&null!=a){s.style.display="block";var d=document.createElement("p");d.textContent="Ora: "+l+" - Codice campo: "+a,s.appendChild(d)}else s.style.display="none"}})(i,e,n,o,l,a);let r=new URLSearchParams;if(r.append("orario1",n),r.append("campo1",l),r.append("orario2",o),r.append("campo2",a),informazioni_prenotazione=r,"continua"===s.value){countdownInterval=function e(t){let n=60*t,o=setInterval(function(){var e=Math.floor(n/60),l=n%60;e=e<10?"0"+e:e,l=l<10?"0"+l:l,document.getElementById("countdown").textContent=e+":"+l,percentage=n/(60*t)*100,circleTimer.style.background=`conic-gradient(rgb(226, 157, 29) ${percentage}%, transparent ${percentage}%)`,--n<0&&(clearInterval(o),document.getElementById("overlay").style.display="block",document.getElementById("modal").style.display="none",document.getElementById("time-elapsed").style.display="block",document.getElementById("time-elapsed").focus())},1e3);return o}(10),document.getElementById("set-prenotation").style.display="none",document.getElementById("end-prenotation").style.display="block";let d=document.getElementById("back-set-prenot");d.addEventListener("click",function(){fetch("../php/rilascioPrenotazione.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r.toString()}).catch(e=>{console.error("Errore durante la richiesta fetch:",e)}),stopCountdown(),document.getElementById("countdown").textContent="10:00",document.getElementById("set-prenotation").style.display="block",document.getElementById("end-prenotation").style.display="none"})}else if("conferma"===s.value){document.getElementById("set-prenotation").style.display="none",document.getElementById("show-pren-details").style.display="block",document.getElementById("logged-in-confirmation").style.display="block";let c=document.getElementById("back-to-times");c.addEventListener("click",function(){fetch("../php/rilascioPrenotazione.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r}).then(e=>{document.getElementById("set-prenotation").style.display="block",document.getElementById("show-pren-details").style.display="none",document.getElementById("logged-in-confirmation").style.display="none"}).catch(e=>{console.error("Errore durante la richiesta fetch:",e)})})}}).catch(e=>console.error("Errore:",e)),scrollToTop()});let c=document.getElementById("loginAutentication"),y=document.getElementById("overlay"),m=document.getElementById("close");c.addEventListener("click",()=>{y.style.display="block"}),m.onclick=function(){y.style.display="none"},window.addEventListener("click",e=>{let t=document.getElementById("time-elapsed").style.display;e.target===y&&(y.style.display="none","block"===t&&(f(),scrollToTop()))});var g=document.getElementById("errore_email"),u=document.getElementById("errore_password");g&&""===g.textContent.trim()&&(g.style.display="none"),u&&""===u.textContent.trim()&&(u.style.display="none");var E=document.getElementById("errore_nome_info"),h=document.getElementById("errore_email_info"),I=document.getElementById("errore_conf_email"),B=document.getElementById("errore_box");function f(){fetch("../php/rilascioPrenotazione.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:informazioni_prenotazione.toString()}).then(e=>{if(!e.ok)throw Error(`Errore nella richiesta fetch: ${e.status}`);document.getElementById("set-prenotation").style.display="block",document.getElementById("end-prenotation").style.display="none",document.getElementById("show-pren-details").style.display="none",document.getElementById("logged-in-confirmation").style.display="none",document.getElementById("modal").style.display="block",document.getElementById("time-elapsed").style.display="none"}).catch(e=>{console.error("Errore durante la richiesta fetch:",e)})}E&&""===E.textContent.trim()&&(E.style.display="none"),h&&""===h.textContent.trim()&&(h.style.display="none"),I&&""===I.textContent.trim()&&(I.style.display="none"),B&&""===B.textContent.trim()&&(B.style.display="none"),document.getElementById("submitForm").addEventListener("click",function(){var e=document.getElementById("nome").value.trim(),t=document.getElementById("email_user").value.trim(),n=document.getElementById("conf_email_user").value.trim(),o=document.getElementById("check-disclaimer"),l=document.getElementById("errore_nome_info"),i=document.getElementById("errore_email_info"),a=document.getElementById("errore_conf_email"),r=document.getElementById("errore_box");if(""===e||e.length<3){l.textContent="Il campo nome \xe8 richiesto e deve avere una lunghezza di almeno 3 caratteri.",l.style.display="block";return}if(l.textContent="",""===t){i.textContent="Il campo email \xe8 richiesto.",i.style.display="block";return}if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t))i.textContent="";else{i.textContent="Il formato email non \xe8 valido.",i.style.display="block";return}if(""===n){a.textContent="Il campo conferma email non pu\xf2 essere vuoto.",a.style.display="block";return}if(n!==t){a.textContent="Le due mail non coincidono.",a.style.display="block";return}if(a.textContent="",o.checked)r.textContent="";else{r.textContent="Accetta i termini e le condizioni per continuare",r.style.display="block";return}let d=new URLSearchParams;for(let s of(d.append("nome",e),d.append("email",t),informazioni_prenotazione.entries()))d.append(s[0],s[1]);return fetch("../php/aggiornaUserPrenot.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:d}).catch(e=>console.error("Errore:",e)),document.getElementById("overlay").style.display="none",document.getElementById("set-prenotation").style.display="none",document.getElementById("end-prenotation").style.display="none",document.getElementById("show-pren-details").style.display="block",document.getElementById("logged-in-confirmation").style.display="none",scrollToTop(),!0}),document.getElementById("submit-session-ended").addEventListener("click",function(){f(),scrollToTop()})});
